{% extends "base.html" %}

{% block content %}
<p>
  <strong>First Name:</strong> {{ current_user.firstname }}<br />
  <strong>Last Name:</strong> {{ current_user.lastname }}<br />
  <strong>Email:</strong> {{ current_user.email }}<br />
  <strong>Balance:</strong> {{ current_user.balance }}
  <button onclick="openPopup()" class="btn btn-primary">Add or Withdraw Balance</button>
</p>
<br><br>

<h2>Your Recent Purchases:</h2>
<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <tr>
      <th scope="col">Purchase ID</th>
      <th scope="col">Product Name</th>
      <th scope="col">Date Purchased</th>
    </tr>
  </thead>
  <tbody>
    {% for purchase in purchase_history %}
    <tr>
      <th scope="row">{{ purchase.id }}</th>
      <td>{{ purchase.pid }}</td>
      <td>{{ purchase.time_purchased }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Popup Container -->
<div id="popup" class="popup-container">
  <div class="popup-content">
    <div id="popup-body">
      <!-- Content from 'update_balance' will load here -->
    </div>
  </div>
</div>

<style>
  .popup-container {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
  }
  .popup-content {
    background-color: white;
    padding: 20px;
    border-radius: 5px;
    max-width: 700px;
    width: 80%;
    text-align: center;
  }
</style>

<script>
  // Open popup and load 'update_balance' content
  function openPopup() {
    fetch("{{ url_for('users.update_balance') }}")
      .then(response => response.text())
      .then(data => {
        document.getElementById("popup-body").innerHTML = data;
        document.getElementById("popup").style.display = "flex";
      })
      .catch(error => console.error('Error loading popup content:', error));
  }

  // Close popup by clicking outside the content area
  window.onclick = function(event) {
    const popup = document.getElementById("popup");
    if (event.target === popup) {
      popup.style.display = "none";
    }
  };
</script>
{% endblock %}
